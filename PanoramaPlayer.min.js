(function(){function f(a){var b=curtop=0;if(a.offsetParent){do b+=a.offsetLeft,curtop+=a.offsetTop;while(a=a.offsetParent)}return{left:b,top:curtop}}function e(a,b,c){a.style[b]=c;b=b[0].toUpperCase()+b.substring(1,b.length);a.style["webkit"+b]=c;a.style["moz"+b]=c;a.style["ms"+b]=c;a.style["o"+b]=c}var b=function(a){"undefined"==typeof THREE?console.error("Please Import THREE.JS Firstly"):void 0!=a.video&&(this.video=a.video,this.videoWidth=void 0==a.videoWidth?900:a.videoWidth,this.videoHeight=
void 0==a.videoHeight?506:a.videoHeight,this.mappingType=void 0==a.mappingType?this.MappingType.BOX:a.mappingType,this.isVideo=void 0==a.isVideo?!0:a.isVideo,this.isOrientControl=void 0==a.isOrientControl?!0:a.isOrientControl,this.isTouchControl=void 0==a.isTouchControl?!0:a.isTouchControl,this.isMouseControl=void 0==a.isMouseControl?!0:a.isMouseControl,this.showPlayerControler=void 0==a.showPlayerControler?!0:a.showPlayerControler,this.cameraFov=void 0==a.cameraFov?75:a.cameraFov,this.size=600,this.isUserInteracting=
!1,this.easing=.2,this.onMouseDownLat=this.onMouseDownLon=this.onPointerDownPointerY=this.onPointerDownPointerX=this.onMouseDownMouseY=this.onMouseDownMouseX=0,this.lon=90,this.latAdd=this.lonAdd=this.theta=this.phi=this.lat=0,this.playerProgressCacheDom=this.playerProgressDom=this.playerProgressBorderDom=this.playerVolumeDom=this.playerButtonDom=this.videoDom=this.canvasDom=this.playerDom=null,this.playerProgressWidth=720,this.playerVolumeDom=this.isProgressInteracting=!1,this.renderer=this.scene=
this.camera=null,this.target=new THREE.Vector3,this.texture=null,this.createDom(),this.createDomStyle(),this.init(),this.animate())};b.prototype.MappingType={SPHERE:0,BOX:1};b.prototype.init=function(){this.camera=new THREE.PerspectiveCamera(this.cameraFov,this.videoWidth/this.videoHeight,1,2*this.size+100);this.scene=new THREE.Scene;this.texture=new THREE.VideoTexture(video);this.texture.minFilter=THREE.LinearFilter;this.texture.magFilter=THREE.LinearFilter;this.texture.format=THREE.RGBFormat;this.material=
new THREE.MeshBasicMaterial({map:this.texture,side:THREE.DoubleSide});this.mappingType==this.MappingType.BOX?this.createBoxScene():this.mappingType==this.MappingType.SPHERE&&this.createSphereScene();try{this.renderer=new THREE.WebGLRenderer({antialias:!0}),this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(this.videoWidth,this.videoHeight),this.canvasDom=this.renderer.domElement,this.canvasDom.className+="panorama_canvas",this.playerDom.appendChild(this.canvasDom)}catch(b){alert(b)}this.isMouseControl&&
(this.canvasDom.addEventListener("mousedown",this.onCanvasMouseDown.bind(this),!1),this.canvasDom.addEventListener("mousemove",this.onCanvasMouseMove.bind(this),!1),this.canvasDom.addEventListener("mouseup",this.onCanvasMouseUp.bind(this),!1));this.isTouchControl&&(this.canvasDom.addEventListener("touchstart",this.onCanvasTouchStart.bind(this),!1),this.canvasDom.addEventListener("touchmove",this.onCanvasTouchMove.bind(this),!1));if(this.isOrientControl){var a=new Orienter,d=this;a.handler=function(a){var b=
a.lon-d.lonAdd;180<b?d.lonAdd+=360:-180>b&&(d.lonAdd-=360);d.lonAdd+=(a.lon-d.lonAdd)*d.easing;b=a.lat-d.latAdd;180<b?d.latAdd-=360:-180>b&&(d.latAdd+=360);d.latAdd+=(a.lat-d.latAdd)*d.easing};a.init()}window.addEventListener("resize",this.onWindowResize.bind(this),!1)};b.prototype.createBoxScene=function(){var a=[];ux=1/3;uy=.5;for(var b=0;6>b;b++){var c=new THREE.PlaneGeometry(this.size+2,this.size+2);this.change_uvs(c,ux,uy,b%3,b%2);c=new THREE.Mesh(c,this.material);a.push(c);this.scene.add(c)}a[0].position.x=
0;a[0].position.y=0;a[0].position.z=-this.size/2;a[1].position.x=this.size/2;a[1].position.y=0;a[1].position.z=0;a[1].rotation.y=-Math.PI/2;a[2].position.x=0;a[2].position.y=-this.size/2;a[2].position.z=0;a[2].rotation.x=Math.PI/2;a[2].rotation.y=Math.PI;a[3].position.x=0;a[3].position.y=0;a[3].position.z=this.size/2;a[3].rotation.y=Math.PI;a[4].position.x=-this.size/2;a[4].position.y=0;a[4].position.z=0;a[4].rotation.y=Math.PI/2;a[5].position.x=0;a[5].position.y=this.size/2;a[5].position.z=0;a[5].rotation.x=
Math.PI/2;a[5].rotation.y=Math.PI};b.prototype.createSphereScene=function(){var a=new THREE.SphereBufferGeometry(this.size,36,36),a=new THREE.Mesh(a,this.material);this.scene.add(a)};b.prototype.change_uvs=function(a,b,c,e,f){a=a.faceVertexUvs[0];for(var h=0;h<a.length;h++)for(var l=a[h],k=0;k<l.length;k++){var g=l[k];g.x=(g.x+e)*b;g.y=(g.y+f)*c}};b.prototype.onWindowResize=function(){this.camera.aspect=this.videoWidth/this.videoHeight;this.camera.updateProjectionMatrix();this.renderer.setSize(this.videoWidth,
this.videoHeight)};b.prototype.onCanvasMouseDown=function(a){a.preventDefault();this.isUserInteracting=!0;this.onPointerDownPointerX=a.clientX;this.onPointerDownPointerY=a.clientY;this.onPointerDownLon=this.lon;this.onPointerDownLat=this.lat};b.prototype.onCanvasMouseMove=function(a){!0===this.isUserInteracting&&(this.lon=.1*(this.onPointerDownPointerX-a.clientX)+this.onPointerDownLon,this.lat=.1*(a.clientY-this.onPointerDownPointerY)+this.onPointerDownLat)};b.prototype.onCanvasMouseUp=function(a){this.isUserInteracting=
!1};b.prototype.onCanvasTouchStart=function(a){1==a.touches.length&&(a.preventDefault(),this.onPointerDownPointerX=a.touches[0].pageX,this.onPointerDownPointerY=a.touches[0].pageY,this.onPointerDownLon=this.lon,this.onPointerDownLat=this.lat)};b.prototype.onCanvasTouchMove=function(a){1==a.touches.length&&(a.preventDefault(),this.lon=.1*(this.onPointerDownPointerX-a.touches[0].pageX)+this.onPointerDownLon,this.lat=.1*(a.touches[0].pageY-this.onPointerDownPointerY)+this.onPointerDownLat)};b.prototype.animate=
function(){requestAnimationFrame(this.animate.bind(this));this.updateScene();this.showPlayerControler&&this.updatePlayerControler()};b.prototype.updateScene=function(){this.lat=Math.max(-85,Math.min(85,this.lat));this.latAdd=Math.max(-85,Math.min(85,this.latAdd));this.phi=this.isOrientControl?THREE.Math.degToRad(90-this.latAdd):THREE.Math.degToRad(90-this.lat);this.theta=THREE.Math.degToRad(this.lon-this.lonAdd);this.target.x=this.size*Math.sin(this.phi)*Math.cos(this.theta);this.target.y=this.size*
Math.cos(this.phi);this.target.z=this.size*Math.sin(this.phi)*Math.sin(this.theta);this.camera.lookAt(this.target);this.renderer.render(this.scene,this.camera)};b.prototype.updatePlayerControler=function(){e(this.playerProgressDom,"transform","translate3d("+(this.videoDom.currentTime/this.videoDom.duration-1)*this.playerProgressWidth+"px, 0px, 0px)");0!=this.videoDom.seekable.length&&e(this.playerProgressCacheDom,"transform","translate3d("+(this.videoDom.seekable.end(0)/this.videoDom.duration-1)*
this.playerProgressWidth+"px, 0px, 0px)")};b.prototype.createDom=function(){this.videoDom=document.getElementsByClassName("panorama")[0];this.videoDom.style.display="none";this.playerDom=document.createElement("div");this.playerDom.className="panorama_player";this.playerDom.style.position="relative";this.videoDom.parentNode.appendChild(this.playerDom);this.playerDom.innerHTML='<div class="panorama_play_controler">    <div class="panorama_play_button">        <svg class="panorama_button_icon panorama_button_pause" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 125" enable-background="new 0 0 100 100" xml:space="preserve" style="fill:rgb(255, 255, 255);"><path fill-rule="evenodd" clip-rule="evenodd" d="M76.2,94.9C70,94.9,65,90.1,65,84.2V15.8c0-5.9,5-10.7,11.2-10.7  c6.2,0,11.2,4.8,11.2,10.7v68.4C87.4,90.1,82.4,94.9,76.2,94.9"/><path fill-rule="evenodd" clip-rule="evenodd" d="M23.8,94.9c-6.2,0-11.2-4.8-11.2-10.7V15.8c0-5.9,5-10.7,11.2-10.7  C30,5.1,35,9.9,35,15.8v68.4C35,90.1,30,94.9,23.8,94.9"/></svg>        <svg class="panorama_button_icon panorama_button_play" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 125" enable-background="new 0 0 100 100" xml:space="preserve" style="fill:rgb(255, 255, 255);"><path d="M5.9,9.777C5.9,4.377,10.276,0,15.676,0c1.677,0,2.74,0.438,4.61,1.182l68.577,39.9c3.189,1.89,4.666,4.927,5.236,8.428  v0.982c-0.57,3.499-2.047,6.537-5.236,8.428L20.287,98.819c-1.871,0.745-2.934,1.181-4.61,1.181c-5.4,0-9.776-4.377-9.776-9.777  V9.777z"/></svg>    </div>    <div class="panorama_progress_wrap">        <div class="panorama_progress_border" >            <div class="panorama_progress_cache" ></div>            <div class="panorama_progress" ></div>        </div>        <div class="panorama_volume" >            <div class="panorama_volume_item volume_item1 volume_selected" ></div>            <div class="panorama_volume_item volume_item2 volume_selected" ></div>            <div class="panorama_volume_item volume_item3 volume_selected" ></div>            <div class="panorama_volume_item volume_item4 " ></div>            <div class="panorama_volume_item volume_item5" ></div>            <div class="panorama_volume_item volume_item6" ></div>            <div class="panorama_volume_item volume_item7" ></div>            <div class="panorama_volume_item volume_item8" ></div>            <div class="panorama_volume_item volume_item9" ></div>            <div class="panorama_volume_item volume_itema" ></div>        </div>    </div></div>';
this.videoDom.autoplay?(this.playerDom.getElementsByClassName("panorama_button_pause")[0].style.display="block",this.playerDom.getElementsByClassName("panorama_button_play")[0].style.display="none"):(this.playerDom.getElementsByClassName("panorama_button_pause")[0].style.display="none",this.playerDom.getElementsByClassName("panorama_button_play")[0].style.display="block");this.playerDom.addEventListener("mouseover",this.playerMouseOver.bind(this),!1);this.playerDom.addEventListener("mousedown",this.playerMouseOver.bind(this),
!1);this.playerDom.addEventListener("touchmove",this.playerMouseOver.bind(this),!1);this.playerDom.addEventListener("touchstart",this.playerMouseOver.bind(this),!1);this.playerDom.addEventListener("touchend",this.playerTouchEnd.bind(this),!1);this.playerDom.addEventListener("mouseleave",this.playerMouseLeave.bind(this),!1);this.playerButtonDom=this.playerDom.getElementsByClassName("panorama_play_button")[0];this.playerProgressBorderDom=this.playerDom.getElementsByClassName("panorama_progress_border")[0];
this.playerProgressDom=this.playerDom.getElementsByClassName("panorama_progress")[0];this.playerProgressCacheDom=this.playerDom.getElementsByClassName("panorama_progress_cache")[0];this.playerProgressBorderDom.addEventListener("mousedown",this.progressMouseDown.bind(this),!1);this.playerProgressBorderDom.addEventListener("mousemove",this.progressMouseMove.bind(this),!1);this.playerProgressBorderDom.addEventListener("mouseup",this.progressMouseUp.bind(this),!1);this.playerProgressBorderDom.addEventListener("touchmove",
this.progressTouchMove.bind(this),!1);this.playerVolumeDom=this.playerDom.getElementsByClassName("panorama_volume")[0];this.playerVolumeDom.addEventListener("mousedown",this.volumeMouseDown.bind(this),!1);this.playerVolumeDom.addEventListener("mousemove",this.volumeMouseMove.bind(this),!1);this.playerVolumeDom.addEventListener("mouseup",this.volumeMouseUp.bind(this),!1);this.playerVolumeDom.addEventListener("touchmove",this.volumeTouchMove.bind(this),!1);this.videoDom.volume=.5;this.changeVolume(30);
this.playerButtonDom.addEventListener("click",function(a){a.preventDefault();this.videoDom.paused?(this.videoDom.play(),this.playerDom.getElementsByClassName("panorama_button_pause")[0].style.display="block",this.playerDom.getElementsByClassName("panorama_button_play")[0].style.display="none"):(this.videoDom.pause(),this.playerDom.getElementsByClassName("panorama_button_pause")[0].style.display="none",this.playerDom.getElementsByClassName("panorama_button_play")[0].style.display="block")}.bind(this),
!1)};b.prototype.createDomStyle=function(){var a=this.videoWidth-100;this.playerProgressWidth=a-100;var b=document.createElement("style");b.innerHTML="\n.panorama_player {\n\tposition: relative;\n\twidth: "+this.videoWidth+"px;\n\theight: "+this.videoHeight+"px;\n}\n.panorama_canvas {\n\tcursor: move;\n}\n.panorama_play_controler {\n\t-webkit-transition: opacity 0.5s;\n\ttransition: opacity 0.5s;\n}\n.panorama_play_button {\n\tposition: absolute;\n\twidth: 60px;\n\theight: 40px;\n\tbottom: 10px;\n\tleft: 10px;\n\tbackground-color: rgba(0, 0, 0, 0.5);\n\tborder-radius:6px;\n\tcursor: pointer;\n}\n.panorama_button_pause {\n\twidth: 30px;\n\theight: 30px;\n\tposition: absolute;\n\ttop: 8px;\n\tleft: 15px;\n}\n.panorama_button_play {\n\twidth: 30px;\n\theight: 30px;\n\tposition: absolute;\n\ttop: 8px;\n\tleft: 16px;\n\tdisplay: none;\n}\n.panorama_progress_wrap {\n\twidth:"+
a+"px; \n\theight: 40px;\n\tbackground-color: rgba(0, 0, 0, 0.5);\n\tborder-radius:6px;\n\tposition: absolute;\n\tbottom: 10px;\n\tleft: 80px;\n}\n.panorama_progress_cache {\n\twidth:100%; \n\theight: 10px; \n\tbackground-color: rgba(255, 255, 255, 0.2);\n\tposition:absolute; \n\t-webkit-transform: translate3d(-9999px, 0px, 0px); \n\t        transform: translate3d(-9999px, 0px, 0px);\n}\n.panorama_progress {\n\twidth:100%; \n\theight: 10px; \n\tbackground-color: rgb(113, 216, 225);\n\tposition:absolute; \n\t-webkit-transform: translate3d(-9999px, 0px, 0px); \n\t        transform: translate3d(-9999px, 0px, 0px);\n}\n.panorama_progress_border {\n\tpadding: 1px;\n\twidth:"+
this.playerProgressWidth+"px; \n\theight: 10px; \n\tborder: 1px rgba(255, 255, 255, 0.5) solid; \n\tposition:absolute; \n\tbottom:13px; \n\tleft:10px;\t\n\tcursor: pointer;\noverflow: hidden;\n}\n.panorama_volume {\n\twidth: 60px;\n\theight: 20px;\n\tposition: absolute;\n\tright: 10px;\n\ttop: 10px;\n\tdisplay: -webkit-box;\n\tdisplay: -ms-flexbox;\n\tdisplay: flex;\n\t-ms-flex-pack: distribute;\n\t    justify-content: space-around;\n\tcursor: pointer;\n}\n.panorama_volume_item {\n\twidth: 3px;\n\theight: 20px;\n\tbackground: rgba(255, 255, 255, 0.2);\n}\n.volume_selected {\n\tbackground-color: rgb(113, 216, 225);\n}";
document.getElementsByTagName("head")[0].appendChild(b);this.showPlayerControler||(this.playerDom.getElementsByClassName("panorama_play_controler")[0].style.display="none")};b.prototype.playerMouseOver=function(a){this.isProgressInteracting||this.isVolumeInteracting||this.isUserInteracting||this.showControl()};b.prototype.playerMouseLeave=function(a){this.hideControl()};b.prototype.playerTouchEnd=function(a){setTimeout(this.hideControl.bind(this),3E3)};b.prototype.showControl=function(){this.playerDom.getElementsByClassName("panorama_play_controler")[0].style.opacity=
"1"};b.prototype.hideControl=function(){this.playerDom.getElementsByClassName("panorama_play_controler")[0].style.opacity="0"};b.prototype.progressMouseDown=function(a){a.preventDefault();a=a.pageX-f(this.playerProgressBorderDom).left;this.videoDom.currentTime=this.videoDom.duration*a/this.playerProgressWidth;this.isProgressInteracting=!0};b.prototype.progressMouseMove=function(a){this.isProgressInteracting&&(a=a.pageX-f(this.playerProgressBorderDom).left,this.videoDom.currentTime=this.videoDom.duration*
a/this.playerProgressWidth)};b.prototype.progressMouseUp=function(a){this.isProgressInteracting=!1};b.prototype.progressTouchMove=function(a){1==event.touches.length&&(a=a.touches[0].pageX-f(this.playerProgressBorderDom).left,this.videoDom.currentTime=this.videoDom.duration*a/this.playerProgressWidth)};b.prototype.volumeMouseDown=function(a){a.preventDefault();a=a.pageX-f(this.playerVolumeDom).left;this.changeVolume(a);this.isVolumeInteracting=!0};b.prototype.volumeMouseMove=function(a){this.isVolumeInteracting&&
(a=a.pageX-f(this.playerVolumeDom).left,this.changeVolume(a))};b.prototype.volumeMouseUp=function(a){this.isVolumeInteracting=!1};b.prototype.volumeTouchMove=function(a){1==event.touches.length&&(a=a.touches[0].pageX-f(this.playerVolumeDom).left,this.changeVolume(a))};b.prototype.changeVolume=function(a){a/=60;a=0>a?0:a;a=1<a?1:a;this.videoDom.volume=a;for(var b=this.playerDom.getElementsByClassName("panorama_volume_item"),c=0;c<b.length;c++)b[c].className="panorama_volume_item volume_item"+(10==
c?"a":""+c),c/10<a&&(b[c].className+=" volume_selected")};window.PanoramaPlayer=b})();
(function(f){var e="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global;"function"===typeof define&&define.amd?define(["exports"],function(b){e.Orienter=f(e,b)}):"undefined"!==typeof exports?f(e,exports):e.Orienter=f(e,{})})(function(f,e){e=function(){this.initialize.apply(this,arguments)};(function(b,a){for(var d in a)b[d]=a[d]})(e.prototype,{lon:0,lat:0,direction:0,fix:0,os:"",initialize:function(){this.lat=this.lon=0;this.direction=window.orientation||
0;switch(this.direction){case 0:this.fix=0;break;case 90:this.fix=-270;break;case -90:this.fix=-90}navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?this.os="ios":this.os=-1<navigator.userAgent.indexOf("Android")||navigator.userAgent.indexOf("Linux")?"android":""},init:function(){this._orient=this.orientHandler.bind(this);window.addEventListener("deviceorientation",this._orient,!1);this._change=this.changeHandler.bind(this);window.addEventListener("orientationchange",this._change,!1)},destroy:function(){window.removeEventListener("deviceorientation",
this._orient,!1);window.removeEventListener("orientationchange",this._change,!1)},changeHandler:function(b){this.direction=window.orientation},orientHandler:function(b){switch(this.os){case "ios":switch(this.direction){case 0:this.lon=b.alpha+b.gamma;0<b.beta&&(this.lat=b.beta-90);break;case 90:this.lon=0>b.gamma?b.alpha-90:b.alpha-270;this.lat=0<b.gamma?90-b.gamma:-90-b.gamma;break;case -90:this.lon=0>b.gamma?b.alpha-90:b.alpha-270,this.lat=0>b.gamma?90+b.gamma:-90+b.gamma}break;case "android":switch(this.direction){case 0:this.lon=
b.alpha+b.gamma+30;this.lat=90<b.gamma?90-b.beta:b.beta-90;break;case 90:this.lon=b.alpha-230;this.lat=0<b.gamma?270-b.gamma:-90-b.gamma;break;case -90:this.lon=b.alpha-180,this.lat=-90+b.gamma}}this.lon+=this.fix;this.lon%=360;0>this.lon&&(this.lon+=360);this.lon=Math.round(this.lon);this.lat=Math.round(this.lat);this.handler&&this.handler.apply(this,[{a:Math.round(b.alpha),b:Math.round(b.beta),g:Math.round(b.gamma),lon:this.lon,lat:this.lat,dir:this.direction}])}});return e});